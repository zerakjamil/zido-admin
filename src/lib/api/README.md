Zido Admin API Client

Structure
- src/lib/api/client.ts: Axios client + Orval mutator with auth header and URL normalization
- src/lib/api/queryClient.ts: QueryClient singleton
- src/lib/api/react-query-provider.tsx: Provider wrapper for App Router
- src/lib/api/generated/*: Autogenerated by Orval from admin-api-openapi.json
- src/lib/api/hooks.ts: Convenience hooks that wrap generated ones when needed

Generation
- OpenAPI file: admin-api-openapi.json at project root (update orval.config.ts if moved)
- Install dev tool: npm i -D orval
- Generate: npm run generate:api
- Watch mode (optional): npx orval --config orval.config.ts --watch

React Query
- App is wrapped with React Query Provider in src/app/layout.tsx
- Generated hooks (e.g., useAdminLogin, useGetAdminProfile) are ready under src/lib/api/generated
- Orval also generates getXQueryKey/getXQueryOptions to help with cache keys and invalidation

Auth & State
- Auth state lives in src/lib/auth-store.ts (Zustand)
- Store uses generated adminLogin/adminLogout/getAdminProfile
- axios client auto-injects token and redirects to /login on 401/403

Env
- NEXT_PUBLIC_API_URL should point to API origin, e.g. https://api.zidobid.com
- Do not include /api/v1 in the env var; paths start with /v1 and are normalized to /api/v1 by the axios mutator

Using generated hooks
- Queries
  - const users = useGetAdminUsers({ page, per_page, search, status, sort_by, sort_direction })
  - const user = useGetAdminUser({ id })
  - const stats = useGetDashboardStats()
  - const banners = useGetAdminPromotionalBanners({ page, per_page, position, status })
- Mutations
  - const updateUser = useUpdateAdminUser({ mutation: { onSuccess: () => qc.invalidateQueries({ queryKey: getGetAdminUsersQueryKey(params) }) } })
  - const deleteUser = useDeleteAdminUser({ mutation: { onSuccess: () => qc.invalidateQueries({ queryKey: getGetAdminUsersQueryKey(params) }) } })
  - const suspendUser = useSuspendAdminUser({ mutation: { onSuccess: () => qc.invalidateQueries({ queryKey: getGetAdminUsersQueryKey(params) }) } })
  - const unsuspendUser = useUnsuspendAdminUser({ mutation: { onSuccess: () => qc.invalidateQueries({ queryKey: getGetAdminUsersQueryKey(params) }) } })

Cache invalidation
- Import the generated getXQueryKey helper and pass the same params used for the list query
- Example:
  - const params = { page, per_page, search, status, sort_by, sort_direction }
  - qc.invalidateQueries({ queryKey: getGetAdminUsersQueryKey(params) })

OpenAPI spec tips (OAS 3.0)
- Nullable: use { "type": "string", "nullable": true } instead of ["string","null"]
- Date/time: use { "type": "string", "format": "date-time" } or "date"
- Path params: declare each with { in: "path", required: true, schema: { type: "integer" } }
- Query params: camel_case in spec maps to named params in hooks
- Empty responses: return 204 with just a description
- Enums: list allowed values; Orval will generate union types

Migration guide (legacy -> generated)
- Legacy modules:
  - src/services/zidobid-api.ts
  - src/lib/api-client.ts
- Replace calls with generated client/hooks from src/lib/api/generated
- Mappings (examples):
  - userService.getUsers -> useGetAdminUsers
  - userService.getUser -> useGetAdminUser
  - userService.updateUser -> useUpdateAdminUser
  - userService.deleteUser -> useDeleteAdminUser
  - userService.suspendUser -> useSuspendAdminUser
  - userService.unsuspendUser -> useUnsuspendAdminUser
  - dashboardService.getStats -> useGetDashboardStats
  - categoryService.getCategories -> useGetAdminCategories
  - bannerService.getBanners -> useGetAdminPromotionalBanners
  - bidService.getBids -> useGetAdminBids
  - reportsService.getRevenueReport -> useGetAdminRevenueReport
  - reportsService.getUserActivityReport -> useGetAdminUserActivityReport

Error handling patterns
- Global: axios interceptor redirects on 401/403; clears localStorage
- Queries: check .isError/.error; render a friendly message
- Mutations: use onError/onSuccess to show toasts and invalidate queries
- Network errors: the mutator rejects Error; attach retry: 0 or 1 as needed

Testing
- Prefer mocking network with MSW in tests to avoid real requests
- For jsdom navigation warnings, avoid touching window.location directly in tests; mock the axios interceptor or replace it in setup
- Example MSW handlers can mirror the OpenAPI paths (e.g., /api/v1/admin/users)

Troubleshooting
- Prettier warning during codegen: install Prettier
  - npm i -D prettier
- Orval codegen errors for nullable fields: ensure you use "nullable": true (already applied here)
- Base URL issues: verify NEXT_PUBLIC_API_URL has only the origin; the client prefixes /api/v1 automatically

Notes
- When changing the spec, re-run: npm run generate:api
- Use the generated getXQueryOptions when you need full control over query options
- Keep UI components lean by colocating hooks near components and passing only data/handlers
